import{Ga as P,a as i,b as u,h as m,i as c,k as s,l,o as h,r as g}from"./chunk-QWBLN4CG.js";var b=class p{constructor(r){this.http=r}API="http://localhost:3000/products";STATIC_DB="backend/db.json";LS_KEY="produtos";listar(){return this.http.get(this.API).pipe(c(r=>r.map(t=>u(i({},t),{img:this.normalizeImgPath(t.img)}))),s(()=>this.http.get(this.STATIC_DB).pipe(c(r=>(r?.products??[]).map(t=>({id:Number(t.id),nome:t.nome,preco:Number(t.preco),img:this.normalizeImgPath(t.img)}))))),s(()=>{let r=localStorage.getItem(this.LS_KEY),t=r?JSON.parse(r):[];return m(t.map(e=>u(i({},e),{img:this.normalizeImgPath(e.img)})))}))}buscarPorId(r){return this.http.get(`${this.API}/${r}`)}incluir(r){return this.http.get(this.API).pipe(c(t=>this.nextId(t)),c(t=>u(i({},r),{id:t})),l(t=>this.http.post(this.API,t)),s(()=>{let t=localStorage.getItem(this.LS_KEY),e=t?JSON.parse(t):[],a=this.nextId(e),o=u(i({},r),{id:a,img:this.normalizeImgPath(r.img)}),d=[...e,o];return localStorage.setItem(this.LS_KEY,JSON.stringify(d)),m(o)}))}editar(r,t){return this.http.patch(`${this.API}/${r}`,t).pipe(s(()=>{let e=localStorage.getItem(this.LS_KEY),o=(e?JSON.parse(e):[]).map(n=>n.id===r?i(i({},n),t):n);localStorage.setItem(this.LS_KEY,JSON.stringify(o));let d=o.find(n=>n.id===r);return m(d)}))}excluir(r){return this.http.delete(`${this.API}/${r}`).pipe(s(()=>{let t=localStorage.getItem(this.LS_KEY),a=(t?JSON.parse(t):[]).filter(o=>o.id!==r);return localStorage.setItem(this.LS_KEY,JSON.stringify(a)),m(void 0)}))}nextId(r){return r.reduce((e,a)=>{let o=Number(a?.id);return Number.isFinite(o)?Math.max(e,o):e},0)+1}normalizeImgPath(r){if(!r)return"images/badboy.png";let t=String(r).trim();return t=t.replace(/^\/+/,""),t=t.replace(/^src\/assets\//i,"assets/"),t=t.replace(/^assets\/images\//i,"images/"),t=t.replace(/^public\//i,""),t=t.replace(/\.PNG$/i,".png"),t}static \u0275fac=function(t){return new(t||p)(g(P))};static \u0275prov=h({token:p,factory:p.\u0275fac,providedIn:"root"})};export{b as a};
