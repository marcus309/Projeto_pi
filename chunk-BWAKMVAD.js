import{a as L}from"./chunk-BSIPSJGH.js";import{$ as E,B as v,C as d,D as h,Ea as V,G as x,H as C,Ja as y,Ka as T,L as m,P as g,Q as r,R as o,S,T as w,U as O,V as f,W as a,X as c,ca as l,da as U,e as k,ea as b,ra as P,t as u,u as p,ya as I,z as M}from"./chunk-QWBLN4CG.js";function H(i,t){if(i&1&&(r(0,"span",17),l(1),o()),i&2){let e=c(3);d(),b("\u2022 ",e.tipo==="adm"?"Administrador":"Cliente")}}function N(i,t){if(i&1){let e=f();r(0,"a",18),a("click",function(){u(e);let n=c(3);return p(n.isOpen=!1)}),l(1,"\xC1rea Admin"),o()}}function j(i,t){if(i&1){let e=f();r(0,"div",6),a("click",function(n){return u(e),p(n.stopPropagation())}),r(1,"div",7)(2,"div",8),l(3),m(4,H,2,1,"span",9),o(),r(5,"div",10),l(6),o()(),r(7,"div",11)(8,"a",12),a("click",function(){u(e);let n=c(2);return p(n.isOpen=!1)}),l(9,"Minha conta"),o(),r(10,"a",13),a("click",function(){u(e);let n=c(2);return p(n.isOpen=!1)}),l(11,"Meus pedidos"),o(),r(12,"a",14),a("click",function(){u(e);let n=c(2);return p(n.isOpen=!1)}),l(13,"Carrinho"),o(),m(14,N,2,0,"a",15),o(),r(15,"button",16),a("click",function(){u(e);let n=c(2);return p(n.sair())}),l(16,"Finalizar sess\xE3o"),o()()}if(i&2){let e=c(2);d(3),b(" ",e.nome," "),d(),g("ngIf",e.tipo),d(2),U(e.email),d(8),g("ngIf",e.tipo==="adm")}}function z(i,t){if(i&1){let e=f();w(0),r(1,"button",3),a("click",function(n){u(e);let _=c();return _.toggleSideba.emit(),p(_.toggleMenu(n))}),S(2,"img",4),o(),m(3,j,17,4,"div",5),O()}if(i&2){let e=c();d(3),g("ngIf",e.isOpen)}}function B(i,t){i&1&&(r(0,"a",19),l(1,"Entrar"),o())}var A="user",R=class i{constructor(t,e,s){this.el=t;this.usuarioService=e;this.router=s}toggleSideba=new h;isOpen=!1;userSession=null;userApi=null;loading=!1;ngOnInit(){this.userSession=this.getSessionUser();let t=this.userSession?.email;t&&(this.loading=!0,this.usuarioService.buscarPorEmail(t.toLowerCase()).subscribe({next:e=>{this.userApi=e,this.loading=!1},error:()=>{this.loading=!1}}))}getSessionUser(){try{let t=localStorage.getItem(A);return t?JSON.parse(t):null}catch{return null}}toggleMenu(t){t&&t.stopPropagation(),this.isOpen=!this.isOpen}onDocumentClick(t){if(!this.isOpen)return;let e=t.target;this.el.nativeElement.contains(e)||(this.isOpen=!1)}onEsc(){this.isOpen&&(this.isOpen=!1)}sair(){return k(this,null,function*(){localStorage.removeItem(A),this.isOpen=!1,yield this.router.navigate(["/login"])})}get isLogged(){return!!this.userSession?.email}get nome(){return this.userApi?.nome||this.userSession?.nome||"Usu\xE1rio"}get email(){return this.userApi?.email||this.userSession?.email||""}get tipo(){return this.userApi?.tipo||this.userSession?.tipo}static \u0275fac=function(e){return new(e||i)(x(M),x(L),x(y))};static \u0275cmp=C({type:i,selectors:[["app-user-menu"]],hostBindings:function(e,s){e&1&&a("click",function(_){return s.onDocumentClick(_)},v)("keydown.escape",function(){return s.onEsc()},v)},outputs:{toggleSideba:"toggleSideba"},decls:4,vars:2,consts:[["loginLink",""],[1,"user-menu",3,"click"],[4,"ngIf","ngIfElse"],["type","button","aria-label","Abrir menu do usu\xE1rio",1,"avatar-btn",3,"click"],["src","/public/images/pessoa.png","alt","Avatar",1,"avatar"],["class","dropdown",3,"click",4,"ngIf"],[1,"dropdown",3,"click"],[1,"user-info"],[1,"name"],["class","role",4,"ngIf"],[1,"email"],[1,"menu"],["routerLink","/conta",3,"click"],["routerLink","/pedidos",3,"click"],["routerLink","/carrinho",3,"click"],["routerLink","/admin",3,"click",4,"ngIf"],[1,"logout",3,"click"],[1,"role"],["routerLink","/admin",3,"click"],["routerLink","/login",1,"btn","btn-primary","btn-login"]],template:function(e,s){if(e&1){let n=f();r(0,"div",1),a("click",function(D){return u(n),p(D.stopPropagation())}),m(1,z,4,1,"ng-container",2)(2,B,2,0,"ng-template",null,0,P),o()}if(e&2){let n=E(3);d(),g("ngIf",s.isLogged)("ngIfElse",n)}},dependencies:[V,I,T],styles:[".user-menu[_ngcontent-%COMP%]{position:relative;display:inline-block}.avatar-btn[_ngcontent-%COMP%]{border:none;background:transparent;padding:0;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}.avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;object-fit:cover;border:1px solid #e5e7eb;background:#f3f4f6}.dropdown[_ngcontent-%COMP%]{position:absolute;right:0;top:calc(100% + 8px);width:280px;background:#fff;border:1px solid #e5e7eb;border-radius:10px;box-shadow:0 8px 30px #00000014;padding:12px;z-index:2000}.user-info[_ngcontent-%COMP%]{border-bottom:1px solid #f1f5f9;padding-bottom:10px;margin-bottom:10px}.user-info[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700;color:#111827;line-height:1.2}.user-info[_ngcontent-%COMP%]   .role[_ngcontent-%COMP%]{font-weight:500;color:#6b7280;margin-left:6px;font-size:12px}.user-info[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;margin-top:2px}.menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}.menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#374151;padding:8px;border-radius:8px}.menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background:#f3f4f6}.logout[_ngcontent-%COMP%]{width:100%;background:#ef4444;color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600}.logout[_ngcontent-%COMP%]:hover{background:#dc2626}.btn-login[_ngcontent-%COMP%]{padding:6px 12px;font-weight:600;border-radius:8px}"]})};export{R as UserMenu};
